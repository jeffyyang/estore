<!-- $Id: account_list.htm 14928 2008-10-06 09:25:48Z testyang $ -->
{if $full_page}
{include file="pageheader.htm"}
{insert_scripts files="../js/utils.js,listtable.js"}
<!-- 搜索 -->
<div class="form-div">
  <form action="javascript:searchRefund()" name="searchForm">
    <img src="images/icon_search.gif" width="35" height="22" border="0" alt="SEARCH" />
    {$lang.order_sn}<input name="order_sn" type="text" id="order_sn" size="15">
    {$lang.label_refund_status}
    <select name="refund_status">
      <option value="0"  >{$lang.all_refund}</option>
      <option value="1" >{$lang.refund_apply}</option>
      <option value="2" >{$lang.refund_confirm}</option>
      <option value="3" >{$lang.refunded}</option>  
    </select>    
    <input type="submit" value="{$lang.button_search}" class="button" />
  </form>
</div>

<form method="post" action="" name="listForm">
<div class="list-div" id="listDiv">
{/if}
  <table cellpadding="3" cellspacing="1">
    <tr>
      <th width="8%">{$lang.order_sn}</th>
      <th>{$lang.refund_amount}</th>
      <th width="20%"><a href="javascript:listTable.sort('add_time', 'DESC'); ">{$lang.apply_time}</a></th>
      <th width="20%">{$lang.refund_time}</th>
      <th width="30%">{$lang.refund_note}</th>
      <th>{$lang.refund_status}</th>
      <th>{$lang.admin_name}</th>
      <th>{$lang.handler}</th>
    </tr>
    {foreach from=$refund_list item=refund}
    <tr>
      <td>{$refund.order_sn}</td>
      <td align="right"><span style="color:#0000FF">{$refund.order_amount}</span></td>
      <td>{$refund.add_time}</td>
      <td>{$refund.paid_time}</td>
      <td>{$refund.user_note|escape:html}</td>
      <td>{if $refund.status eq 1} {$lang.refund_apply} {elseif $refund.status eq 2} {$lang.refund_confirm} {elseif $refund.status eq 3 } {$lang.refunded} {/if}</td>
      <td>{$refund.admin_user}</td>
      <td align="center">
        {if $refund.status eq 1}
        <button type="button" class="button"  onclick="confirmRefund(this,{$refund.log_id});" {if $refund.status neq 1} disabled {/if} >{$lang.action_confirm}</button>
        {elseif $refund.status eq 2}
        <button type="button" class="button"  onclick="finishRefund(this,{$refund.log_id});" {if $refund.status neq 2} disabled {/if} >{$lang.action_refund}</button>        
        {/if}
      </td>
    </tr>
    {foreachelse}
    <tr><td class="no-records" colspan="6">{$lang.no_records}</td></tr>
    {/foreach}
  </table>
<table id="page-table" cellspacing="0">
  <tr>
    <td align="right" nowrap="true">
    {include file="page.htm"}
    </td>
  </tr>
</table>

{if $full_page}
</div>
</form>

<script type="text/javascript" language="javascript">
  <!--
  listTable.recordCount = {$record_count};
  listTable.pageCount = {$page_count};

  {foreach from=$filter item=item key=key}
  listTable.filter.{$key} = '{$item}';
  {/foreach}

  {literal}
  onload = function()
  {
      // 开始检查订单
      startCheckOrder();
  }
  {/literal}

  /**
   * 搜索退款记录
   */
  function searchRefund()
  {
      listTable.filter['order_sn'] = Utils.trim(document.forms['searchForm'].elements['order_sn'].value);
      listTable.filter['status'] = document.forms['searchForm'].elements['refund_status'].value;
      listTable.filter['page'] = 1;
      listTable.query = "query";
      listTable.loadList();
  }

  /* 商户确认退款 */
  function confirmRefund(obj, rec_id)
  {
    var url = "refund.php?act=confirm";
    var res = Ajax.call(url, "&id="+ rec_id, null, "POST", "JSON", false);

    if (res.message)
    {
      alert(res.message);
    }
    if (res.error == 0)
    {
      obj.disabled = 'true';
    }

  }   

  /* 系统管理员完成退款 */
  function finishRefund(obj, rec_id)
  {
    var url = "refund.php?act=end";
    var res = Ajax.call(url, "&id="+ rec_id, null, "POST", "JSON", false);

    if (res.message)
    {
      alert(res.message);
    }
    if (res.error == 0)
    {
      obj.disabled = 'true';
    }
  }    
  //-->
</script>
{include file="pagefooter.htm"}
{/if}