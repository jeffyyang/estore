<!-- $Id: account_list.htm 14928 2008-10-06 09:25:48Z testyang $ -->
{if $full_page}
{include file="pageheader.htm"}
{insert_scripts files="../js/utils.js,listtable.js"}

<div class="form-div">
<form method="post" action="refund.php?act=list" name="searchForm">
  <select name="refund_status" onchange="document.forms['searchForm'].submit()">
    <option value=""  >{$lang.all_refund}</option>
    <option value="1" >{$lang.refund_apply}</option>
    <option value="2" >{$lang.refund_confirm}</option>
    <option value="3" >{$lang.refunded}</option>  
  </select>
  </form>
</div>

<form method="post" action="" name="listForm">
<div class="list-div" id="listDiv">
{/if}

  <table cellpadding="3" cellspacing="1">
    <tr>
      <th width="8%">{$lang.order_sn}</th>
      <th>{$lang.refund_amount}</th>
      <th width="20%">{$lang.apply_time}</th>
      <th width="20%">{$lang.refund_time}</th>
      <th width="30%">{$lang.refund_note}</th>
      <th>{$lang.refund_status}</th>
      <th>{$lang.admin_name}</th>
      <th>{$lang.handler}</th>
    </tr>
    {foreach from=$refund_list item=refund}
    <tr>
      <td>{$refund.order_sn}</td>
      <td align="right"><span style="color:#0000FF">{$refund.order_amount}</span></td>
      <td>{$refund.add_time}</td>
      <td>{$refund.paid_time}</td>
      <td>{$refund.user_note|escape:html}</td>
      <td>{if $refund.status eq 1} {$lang.refund_apply} {elseif $refund.status eq 2} {$lang.refund_confirm} {elseif $refund.status eq 3 } {$lang.refunded} {/if}</td>
      <td>{$refund.admin_user}</td>
      <td align="center">
        {if $refund.status eq 1}
        <button type="button" class="button"  onclick="confirmRefund(this,{$refund.log_id});" {if $refund.status neq 1} disabled {/if} >{$lang.action_confirm}</button>
        {elseif $refund.status eq 2}
        <button type="button" class="button"  onclick="finishRefund(this,{$refund.log_id});" {if $refund.status neq 2} disabled {/if} >{$lang.action_refund}</button>        
        {/if}
      </td>
    </tr>
    {foreachelse}
    <tr><td class="no-records" colspan="6">{$lang.no_records}</td></tr>
    {/foreach}
  </table>
<table id="page-table" cellspacing="0">
  <tr>
    <td align="right" nowrap="true">
    {include file="page.htm"}
    </td>
  </tr>
</table>

{if $full_page}
</div>
</form>

<script type="text/javascript" language="javascript">
  <!--
  listTable.recordCount = {$record_count};
  listTable.pageCount = {$page_count};

  {foreach from=$filter item=item key=key}
  listTable.filter.{$key} = '{$item}';
  {/foreach}

  {literal}
  onload = function()
  {
      // 开始检查订单
      startCheckOrder();
  }
  {/literal}

  /* 商户确认退款 */
  function confirmRefund(obj, rec_id)
  {
    var url = "refund.php?act=confirm";
    var res = Ajax.call(url, "&id="+ rec_id, null, "POST", "JSON", false);

    if (res.message)
    {
      alert(res.message);
    }
    if (res.error == 0)
    {
      obj.disabled = 'true';
    }

  }   

  /* 系统管理员完成退款 */
  function finishRefund(obj, rec_id)
  {
    var url = "refund.php?act=end";
    var res = Ajax.call(url, "&id="+ rec_id, null, "POST", "JSON", false);

    if (res.message)
    {
      alert(res.message);
    }
    if (res.error == 0)
    {
      obj.disabled = 'true';
    }

  }    
  //-->
</script>
{include file="pagefooter.htm"}
{/if}